<form [formGroup]="formPerfil">
    <div class="testbox">
        <h1 class="text-center">Mi Perfil</h1>
        <hr>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <h1 class="">Datos Personales</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-5">
                <label for="nombre">Nombre</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text fa fa-user text-white bg-success" aria-hidden="true"></span>
                    </div>
                    <input type="text" class="form-control" formControlName="nombre" name="nombre" id="nombre" placeholder="Nombre" required
                    [ngClass]="{ 'is-invalid': this.formPerfil.get('nombre').errors}"/>
                </div>
                <div *ngIf="this.formPerfil.get('nombre').errors">
                    <p *ngIf="this.formPerfil.get('nombre').hasError('required')">Debe de introducir un nombre</p>
                </div>
            </div>
            
            <div class="col-md-5">
                <label for="apellidos">Apellidos</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text fa fa-user text-white bg-success" aria-hidden="true"></span>
                    </div>
                    <input type="text" class="form-control" formControlName="apellidos" name="apellidos" id="apellidos" placeholder="Apellidos"
                    [ngClass]="{ 'is-invalid': this.formPerfil.get('apellidos').errors}"/>
                </div>
                <div *ngIf="this.formPerfil.get('apellidos').errors">
                    <p *ngIf="this.formPerfil.get('apellidos').hasError('required')">Debe de introducir un apellido</p>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-1"></div>
            <div class="col-md-5">
                <label for="email">Email</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text fa fa-envelope text-white bg-success" aria-hidden="true"></span>
                    </div>
                    <input type="email" class="form-control" formControlName="email" name="email" id="email" placeholder="Email"
                    [ngClass]="{ 'is-invalid': this.formPerfil.get('email').errors}"/>
                    <div *ngIf="this.formPerfil.get('email').errors" class="row left-margin">
                        <p *ngIf="this.formPerfil.get('email').hasError('required') || this.formPerfil.get('email').hasError('email')">Debe de introducir un email</p>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <label for="dni">DNI/NIF</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text text-white bg-success" aria-hidden="true"><i class="fas fa-id-badge"></i></span>
                    </div>
                    <input maxlength="9" type="text" class="form-control" formControlName="dni" name="dni" id="dni" placeholder="DNI/NIF"
                    pattern="(([X-Z]{1})([-]?)(\d{7})([-]?)([A-Z]{1}))|((\d{8})([-]?)([A-Z]{1}))" [ngClass]="{ 'is-invalid': this.formPerfil.get('dni').errors }" />
                </div>
                <div *ngIf="this.formPerfil.get('dni').errors" class="col-10">
                    <p *ngIf="this.formPerfil.get('dni').errors">Debe de introducir un dni válido</p>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-1"></div>
            <div class="col-md-5">
                <label for="telefono">Teléfono</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text text-white bg-success" aria-hidden="true"><i class="fas fa-phone"></i></span>
                    </div>
                    <input type="text" class="form-control" formControlName="telefono" name="telefono" id="telefono" placeholder="Teléfono" required
                    maxlength="9" pattern="[0-9]{9}" [ngClass]="{ 'is-invalid': this.formPerfil.get('telefono').errors}"/>
                </div>
                <div *ngIf="this.formPerfil.get('telefono').errors" class="col-10">
                    <p *ngIf="this.formPerfil.get('telefono').errors">Debe de introducir un nº de teléfono</p>
                </div>
            </div>
            <div class="col-md-5">
                <label for="direccion">Dirección</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text text-white bg-success" aria-hidden="true"><i class="fas fa-home"></i></span>
                    </div>
                    <input type="text" class="form-control" formControlName="direccion" name="direccion" id="direccion" placeholder="Dirección" required
                    [ngClass]="{ 'is-invalid': this.formPerfil.get('direccion').errors }"/>
                </div>
                <div *ngIf="this.formPerfil.get('direccion').errors" class="col-10">
                    <p *ngIf="this.formPerfil.get('direccion').hasError('required')">Debe de introducir una dirección</p>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-1"></div>
            <div class="col-md-5">
                <label for="provincia">Provincia</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text text-white bg-success" aria-hidden="true"><i class="fas fa-globe-europe"></i></span>
                    </div>
                    <ng-select style="min-width: 330px;" [items]="comboProvincias" formControlName="provincia" bindLabel="descripcion"
                   placeholder="Provincia" [(ngModel)]="provinciaSeleccionada">
                    </ng-select>
                </div>
                <div *ngIf="this.formPerfil.get('provincia').errors" class="col-10">
                    <p *ngIf="this.formPerfil.get('provincia').hasError('required')">Debe de seleccionar una provincia</p>
                </div>
            </div>
            <div class="col-md-5">
                <label for="codigoPostal">Código Postal</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text text-white bg-success" aria-hidden="true"><i class="fas fa-home"></i></span>
                    </div>
                    <input type="text" maxlength="5" class="form-control" formControlName="codigoPostal" name="codigoPostal" id="codigoPostal" placeholder="Código Postal" required
                    maxlength="5" [ngClass]="{ 'is-invalid': this.formPerfil.get('codigoPostal').errors }" pattern="[0-9]{5}"/>
                </div>
                <div *ngIf="this.formPerfil.get('codigoPostal').errors" class="col-10">
                    <p *ngIf="this.formPerfil.get('codigoPostal').errors">Debe de introducir un código postal válido</p>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-1"></div>
            <div class="col-md-5">
                <label for="edad">Edad</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text fa fa-user text-white bg-success" aria-hidden="true"></span>
                    </div>
                    <input type="number" class="form-control" formControlName="edad" min="18" max="130" maxlength="3" name="edad" id="edad" placeholder="Edad" required
                    [ngClass]="{ 'is-invalid': this.formPerfil.get('edad').errors }"/>
                </div>
                <div *ngIf="this.formPerfil.get('edad').value < 18" class="col-10">
                    <p *ngIf="this.formPerfil.get('edad').value < 18">La edad debe ser mínimo 18</p>
                </div>
            </div>
            <div class="col-md-5">
                <label for="sexo">Sexo</label>
                <div class="sexo justify-content-center">
                    <input formControlName="sexo" class="mr-2" type="radio" value="H" id="hombre" name="sexo"/>
                    <label for="male">Hombre</label>
                    <input formControlName="sexo" type="radio" value="M" id="mujer" name="sexo" class="left-margin "/>
                    <label class="ml-2" for="mujer">Mujer</label>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-1"></div>
            <div class="col-md-5">
                <label for="telefono">Contraseña</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text text-white bg-success" aria-hidden="true"><i class="fas fa-unlock-alt"></i></span>
                    </div>
                    <input [type]="tipoPass1EsPassword ? 'text' : 'password'"  class="form-control" formControlName="pass1" name="pass1" id="pass1" placeholder="Contraseña" required
                    [ngClass]="{ 'is-invalid': this.formPerfil.get('pass1').errors}"/>
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fa" [ngClass]="{
                                'fa-eye-slash': !tipoPass1EsPassword,
                                'fa-eye': tipoPass1EsPassword }" (click)="verPass1()"></i>
                        </span>
                     </div>
                </div>
            </div>
            <div class="col-md-5">
                <label for="direccion">Verifica contraseña</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text text-white bg-success" aria-hidden="true"><i class="fas fa-unlock-alt"></i></span>
                    </div>
                    <input [type]="tipoPass2EsPassword ? 'text' : 'password'" class="form-control" formControlName="pass2" name="pass2" id="pass2" placeholder="Verifica contraseña" required
                    [ngClass]="{ 'is-invalid': this.formPerfil.get('pass2').errors}"/>
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fa" [ngClass]="{
                                'fa-eye-slash': !tipoPass2EsPassword,
                                'fa-eye': tipoPass2EsPassword }" (click)="verPass2()"></i>
                        </span>
                     </div>
                </div>
            </div>
            <div class="row mt-2 justify-content-center left-marginPass" id="strength" #strength>
                <div class="col-md-10">
                    <app-password-security [passwordToCheck]="this.formPerfil.controls.pass1.value" [barLabel]="barLabel"></app-password-security>
                </div>
            </div>
        </div>
        <br>
        <div class="row justify-content-center">
            <button class="btn btn-success mr-3" (click)="clickEditar()">Editar</button>
            <button class="btn btn-primary" (click)="clickReestablecer()">Reestablecer</button>
        </div>
        <hr>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <h1 class="">Mis Solicitudes</h1>
            </div>
        </div>
        <div class="mensaje" *ngIf="!sinDatosSolicitudes">
            <div class="row">
                <div class="col-md-1"></div>
                <div class="col-md-5">
                    No hay información para mostrar.
                </div>
            </div>
          </div>

          <div *ngIf="sinDatosSolicitudes" class="mat-elevation-z8">
            <table mat-table [dataSource]="dataSourceSolicitudes" class="mat-elevation-z8" matSort width="100%" #MatSortSolicitudes="matSort">
                <ng-container matColumnDef="idSolicitud">
                <th mat-header-cell *matHeaderCellDef>Id Solicitud</th>
                <td mat-cell *matCellDef="let solicitud"> 
                    {{solicitud.id.idSolicitud + '-' + solicitud.id.idUsuario + '-' + solicitud.id.idAnimal}}
                </td>
              </ng-container>
          
              <ng-container matColumnDef="animal">
                <th mat-header-cell *matHeaderCellDef>Animal</th>
                <td mat-cell *matCellDef="let solicitud"> 
                    {{solicitud.nombreAnimal}}
                </td>
              </ng-container>
          
              <ng-container matColumnDef="tipoAnimal">
                <th mat-header-cell *matHeaderCellDef>Tipo animal</th>
                <td mat-cell *matCellDef="let solicitud"> 
                    {{solicitud.tipoAnimal}}
                </td>
              </ng-container>

              <ng-container matColumnDef="estado">
                <th mat-header-cell *matHeaderCellDef>Estado</th>
                <td mat-cell *matCellDef="let solicitud"> 
                    {{solicitud.estado}}
                </td>
              </ng-container>
              
              <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let solicitud"> 
                    <button class="btn btn-success mr-1" (click)="verSolicitud(solicitud)"><i class="far fa-eye"></i></button>
                    <button class="btn btn-warning mr-1" (click)="editarSolicitud(solicitud)"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger" (click)="eliminarSolicitud(solicitud)"><i class="fas fa-trash-alt"></i></button>
                </td>
              </ng-container>
          
              <tr mat-header-row *matHeaderRowDef="displayedColumnsSolicitudes"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsSolicitudes;"></tr>
            </table>
          </div><!--*ngIf="sinDatosSolicitudes" -->
          <ng-container >
            <mat-paginator #MatPaginatorSolicitudes="matPaginator" class="indexS" [pageSizeOptions]="pageSizeOptions" [showFirstLastButtons]="true"></mat-paginator>
          </ng-container>
        <hr>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <h1 class="">Mis Pedidos</h1>
            </div>
        </div>
        <div class="mensaje" *ngIf="!sinDatosPedidos">
            <div class="row">
                <div class="col-md-1"></div>
                <div class="col-md-5">
                    No hay información para mostrar.
                </div>
            </div>
        </div>
        <div *ngIf="sinDatosPedidos" class="mat-elevation-z8">
            <table mat-table [dataSource]="dataSourcePedidos" class="mat-elevation-z8" matSort width="100%" #MatSortPedidos="matSort">
              <ng-container matColumnDef="idPedido">
                <th mat-header-cell *matHeaderCellDef>Id Pedido</th>
                <td mat-cell *matCellDef="let pedido"> 
                    {{pedido.id.idPedido + '-' + pedido.id.idUsuario}}
                </td>
              </ng-container>
          
              <ng-container matColumnDef="estado">
                <th mat-header-cell *matHeaderCellDef>Estado</th>
                <td mat-cell *matCellDef="let pedido"> 
                    {{pedido.estadoPedido}}
                </td>
              </ng-container>
          
              <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef>Total</th>
                <td mat-cell *matCellDef="let pedido"> 
                    {{pedido.total + '€'}}
                </td>
              </ng-container>

              <ng-container matColumnDef="fechaPedido">
                <th mat-header-cell *matHeaderCellDef>Fecha Pedido</th>
                <td mat-cell *matCellDef="let pedido"> 
                    {{pedido.fechaPedido | date : 'dd/MM/yyyy'}}
                </td>
              </ng-container>

              <ng-container matColumnDef="metodoPago">
                <th mat-header-cell *matHeaderCellDef>Método de pago</th>
                <td mat-cell *matCellDef="let pedido"> 
                    {{pedido.metodopago}}
                </td>
              </ng-container>
              
              <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let pedido"> 
                    <button class="btn btn-success mr-1" (click)="verPedido(pedido)"><i class="far fa-eye"></i></button>
                    <!--<button class="btn btn-warning mr-1"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger" (click)="eliminarSolicitud(solicitud)"><i class="fas fa-trash-alt"></i></button>-->
                </td>
              </ng-container>
          
              <tr mat-header-row *matHeaderRowDef="displayedColumnsPedidos"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsPedidos;"></tr>
            </table>
          </div>
          <mat-paginator #MatPaginatorPedidos="matPaginator" class="perPage" [pageSizeOptions]="pageSizeOptions" [showFirstLastButtons]="true"></mat-paginator>
        <hr>
        <div class="row justify-content-center">
            <button class="btn btn-danger" (click)="eliminarCuenta()">Eliminar cuenta</button>
        </div>
        <br>
    </div>
</form>